<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href=" https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.1/emojionearea.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css"
    />
  </head>

  <body>
    <!-- <div class="log-form">
      <h2>Regiter your account</h2>
      <form action="/user/register" method="POST" id="loginForm">
        <input
          type="text"
          name="username"
          id="username"
          placeholder="username"
        />
        <input
          type="password"
          name="password"
          id="password"
          placeholder="password"
        />
        <button type="submit" class="btn">Login</button>
        <a class="forgot" href="#">Forgot Username?</a>
      </form>
    </div> -->
    <div class="container-fluid h-100 mt-5">
      <div class="row justify-content-center h-100">
        <form action="/user/register" method="POST" id="registerForm">
          <table class="table">
            <tr>
              <td>ID</td>
              <td>
                <input type="text" name="id" id="id" placeholder="ID" />
              </td>
            </tr>
            <tr>
              <td>Server</td>
              <td>
                <input
                  type="text"
                  name="server"
                  id="server"
                  placeholder="Server"
                />
              </td>
            </tr>
            <tr>
              <td>Password</td>
              <td>
                <input
                  type="password"
                  name="password"
                  id="password"
                  placeholder="password"
                />
              </td>
            </tr>
            <tr>
              <td>
                <button type="submit" name="daftar" class="btn btn-primary">
                  Daftar
                </button>
              </td>
            </tr>
          </table>
        </form>
        <table>
          <tr>
            <td>Sudah punya akun? silahkan <a href="login.php">Login</a></td>
          </tr>
        </table>
      </div>
    </div>
    <!--end log form -->

    <script>
      const form = document.getElementById("registerForm");
      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const id = document.getElementById("id").value; // Mengambil nilai input ID
        const server = document.getElementById("server").value; // Mengambil nilai input Server
        const password = document.getElementById("password").value; // Mengambil nilai input Password

        const url =
          "https://id-game-checker.p.rapidapi.com/mobile-legends/" +
          id +
          "/" +
          server;
        const options = {
          method: "GET",
          headers: {
            "X-RapidAPI-Key":
              "d93be65285msh8da3952a1463240p15a8c0jsnc4239879c337",
            "X-RapidAPI-Host": "id-game-checker.p.rapidapi.com",
          },
        };
        let resultApi;
        try {
          const response = await fetch(url, options);
          resultApi = await response.json();
          console.log(resultApi);
        } catch (error) {
          console.error(error);
        }

        // const response = {
        //   success: true,
        //   data: {
        //     game: "Mobile Legends",
        //     userId: "123",
        //     username: "123@2050",
        //   },
        // };

        const username = resultApi.data.username;
        const userId = resultApi.data.userId;
        const pattern = new RegExp(userId);

        const validate = pattern.test(username);
        if (!validate) {
          const response = await fetch("/user/register", {
            method: "POST",
            body: JSON.stringify({
              username: username,
              id: userId,
              password: password,
            }),
            headers: {
              "Content-type": "application/json; charset=UTF-8",
            },
          });

          if (response.ok) {
            const data = await response.json();
            if (data.message === "Pengguna berhasil terdaftar") {
              // Redirect ke halaman beranda atau halaman lainnya
              window.location.href = "/AntiAyam/login"; //redirect ke halaman /AntiAyam
            }
          } else {
            const errorData = await response.json();
            alert("register failed: " + errorData.message);
          }
        } else {
          alert("register failed akun tidak ditemukan");
        }
      });
    </script>
  </body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script
  src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
  integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
  crossorigin="anonymous"
></script>
